<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>홈</title>
</head>
<body>
<h2>홈페이지</h2>

<div id="message"></div>

<div id="profile-section" style="display:none;">
    <h3>프로필 정보</h3>
    <p>이메일: <span id="userEmail"></span></p>
    <p>이름: <span id="name"></span></p>
    <p>생년월일: <span id="birthdate"></span></p>
    <p>자기소개: <span id="bio"></span></p>
</div>

<a href="/logout" id="logout-link">로그아웃</a>
<a href="/profile"><button type="button">프로필 페이지로 이동</button></a>
<form th:action="@{/delete-account}" method="post" style="margin-top: 1rem;">
    <button type="submit">회원탈퇴</button>
</form>

<script>
    const token = localStorage.getItem('jwtToken');

    if (!token) {
        window.location.href = '/login';
    } else {
        fetch('/api/home', {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('인증 실패. 다시 로그인하세요.');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('profile-section').style.display = 'block';
                document.getElementById('userEmail').textContent = data.userEmail;
                if (data.profile) {
                    document.getElementById('name').textContent = data.profile.name || '';
                    document.getElementById('birthdate').textContent = data.profile.birthdate || '';
                    document.getElementById('bio').textContent = data.profile.bio || '';
                }
            })
            .catch(error => {
                console.error(error);
                localStorage.removeItem('jwtToken');
                window.location.href = '/login';
            });
    }

    document.getElementById('logout-link').addEventListener('click', function() {
        localStorage.removeItem('jwtToken');
    });
</script>
</body>
</html>
